Version 4
SHEET 1 5720 1740
WIRE 32 16 16 16
WIRE 320 80 256 80
WIRE -64 96 -64 16
WIRE -64 96 -80 96
WIRE -48 96 -64 96
WIRE 448 96 384 96
WIRE 560 96 448 96
WIRE 608 96 560 96
WIRE 32 112 32 16
WIRE 32 112 16 112
WIRE 144 112 32 112
WIRE 320 112 144 112
WIRE 752 112 720 112
WIRE -48 128 -64 128
WIRE 608 160 608 128
WIRE 720 160 608 160
WIRE 256 176 256 80
WIRE 752 176 752 112
WIRE 752 176 608 176
WIRE 928 192 896 192
WIRE 1264 192 1120 192
WIRE 608 208 608 176
WIRE -272 224 -336 224
WIRE -144 224 -192 224
WIRE -128 224 -144 224
WIRE -64 224 -64 128
WIRE -64 224 -128 224
WIRE 32 224 32 112
WIRE 32 224 16 224
WIRE 720 224 720 160
WIRE 752 224 720 224
WIRE 848 224 752 224
WIRE 928 224 848 224
WIRE 1152 256 1120 256
WIRE -64 288 -64 224
WIRE -144 352 -144 224
WIRE 608 352 608 240
WIRE 656 352 608 352
WIRE 752 352 752 224
WIRE 752 352 736 352
WIRE 896 352 896 192
WIRE 1152 352 1152 256
WIRE 1152 352 896 352
FLAG -768 -272 0
FLAG -768 -352 VCC
FLAG -144 448 0
FLAG 384 112 0
FLAG 352 64 VCC
FLAG 448 16 VCC
FLAG 256 256 0
FLAG 144 112 CRAMP
FLAG 1024 112 VCC
FLAG 1024 336 VCC
FLAG 560 96 RST
FLAG 544 352 0
FLAG 352 128 0
FLAG 848 224 QRST
FLAG -272 432 QRST
FLAG -16 80 VCC
FLAG -16 144 0
FLAG -64 352 0
FLAG -160 96 0
FLAG -128 224 SUMJ
FLAG -336 224 VCC
FLAG 256 80 FSET
SYMBOL voltage -768 -368 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 5
SYMATTR InstName V2
SYMBOL res -176 416 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 250
SYMBOL res 432 0 R0
SYMATTR InstName R12
SYMATTR Value 3.3k
SYMBOL voltage 256 160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 1
SYMATTR InstName V6
SYMBOL res 752 368 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R4
SYMATTR Value 10k
SYMBOL 74hc74 1024 112 R0
SYMATTR InstName U2
SYMBOL xcomp_x11 352 32 R0
SYMATTR InstName U11
SYMATTR Value LM311
SYMBOL 74hc02 656 288 M180
SYMATTR InstName U4
SYMBOL 74hc02 656 176 M180
SYMATTR InstName U10
SYMBOL cap 608 368 M270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C3
SYMATTR Value 300p
SYMBOL res -64 80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL OpAmps\\LT1006 -16 48 R0
SYMATTR InstName U1
SYMBOL res 32 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL res 32 208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL cap -80 288 R0
SYMATTR InstName C2
SYMATTR Value 20n
SYMBOL res -176 208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL nmos -192 352 R0
SYMATTR InstName M1
SYMATTR Value DI_BSS138
TEXT -168 -224 Left 2 !.tran 0.5ms
TEXT -208 -312 Left 2 !.include 74hc.lib
TEXT -184 -368 Left 2 !.include my.lib
TEXT -176 -272 Left 2 !.include LM311.301
TEXT 576 88 Left 2 ;S
TEXT 576 264 Left 2 ;R
TEXT 720 264 Left 2 ;Q
TEXT 712 88 Left 2 ;~Q
TEXT -512 -368 Left 2 !.ic V(QRST)=0
TEXT -504 -320 Left 2 !.ic V(RST)=5
TEXT -504 -248 Left 2 !.ic V(SUMJ)=0
TEXT 432 1272 Left 2 ;issue is that the sum junction voltage changes. \nso a resistor as voltage to current doesnt work.\na proper current source does work\nbut we dont have nice voltage control
TEXT -96 -88 Left 2 ;Deboo integrator.\nfor linear ramp
TEXT 232 -8 Left 2 ;compare
TEXT 608 -16 Left 2 ;state toggle
TEXT 944 0 Left 2 ;50% square wave
TEXT 200 480 Left 2 ;fails below 0.1V\nOK. need better (lower rdson) reset mosfet, to more quickly clear.
TEXT 256 -144 Left 2 ;0.1 - 4V.  range ok. eg. 40x.

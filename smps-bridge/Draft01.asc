Version 4
SHEET 1 5720 1884
WIRE 1280 -96 1216 -96
WIRE 1392 -96 1344 -96
WIRE 1504 -96 1392 -96
WIRE 1680 -96 1584 -96
WIRE 1744 -96 1680 -96
WIRE 1680 -80 1680 -96
WIRE 1680 -16 1216 -16
WIRE 1744 -16 1680 -16
WIRE 1744 32 1744 -16
WIRE 1296 64 1216 64
WIRE 1392 64 1392 -96
WIRE 1392 64 1360 64
WIRE 528 368 304 368
WIRE 304 464 304 368
WIRE 752 464 496 464
WIRE 304 496 224 496
WIRE 528 528 528 368
WIRE 528 528 496 528
WIRE 672 528 528 528
WIRE 1200 528 1120 528
WIRE 1248 528 1200 528
WIRE 1456 528 1328 528
WIRE 864 688 864 480
WIRE 1648 688 864 688
WIRE 672 736 672 528
WIRE 752 736 672 736
WIRE 1600 752 1600 480
WIRE 1600 752 976 752
WIRE 544 816 496 816
WIRE 576 816 544 816
WIRE 208 848 32 848
WIRE 224 848 224 496
WIRE 224 848 208 848
WIRE 304 848 224 848
WIRE 496 944 496 880
WIRE 544 944 496 944
WIRE 576 944 544 944
WIRE 1120 976 1120 528
WIRE 1456 976 1456 528
WIRE 864 1024 864 752
WIRE 976 1024 864 1024
WIRE 1568 1024 1520 1024
WIRE 1648 1024 1648 688
WIRE -192 1072 -208 1072
WIRE 16 1072 -192 1072
WIRE 1168 1072 1120 1072
WIRE 1456 1072 1168 1072
WIRE 144 1088 80 1088
WIRE 400 1088 400 960
WIRE 400 1088 144 1088
WIRE 16 1104 -32 1104
WIRE -32 1216 -32 1104
WIRE 1168 1216 1168 1072
WIRE 1312 1216 1168 1216
WIRE -80 1264 -240 1264
WIRE -240 1328 -240 1264
WIRE -32 1344 -32 1216
WIRE -32 1344 -80 1344
WIRE -240 1392 -240 1328
FLAG -528 -80 0
FLAG -528 -160 VCC
FLAG -704 -64 0
FLAG -704 -144 P15V
FLAG -288 1072 IRAMP
FLAG 544 816 SW
FLAG 80 1104 0
FLAG 48 1056 VCC
FLAG 144 1008 VCC
FLAG 544 944 CSW
FLAG 1744 32 0
FLAG 1120 432 VCC
FLAG 48 1120 0
FLAG 208 848 QRST
FLAG 32 928 0
FLAG 304 816 VCC
FLAG 400 736 VCC
FLAG -192 1136 0
FLAG -240 1472 0
FLAG -32 1216 ISET
FLAG -80 1424 0
FLAG -240 1328 PWR
FLAG 400 384 VCC
FLAG 400 608 VCC
FLAG 752 496 SW
FLAG 1456 432 VCC
FLAG 752 768 SW
FLAG 1200 528 FSW1
FLAG 1456 528 FSW2
FLAG 1168 1296 0
FLAG 1312 1216 IRAMP
SYMBOL voltage -528 -176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 5
SYMATTR InstName V2
SYMBOL ind2 1344 512 R90
WINDOW 0 4 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName L1
SYMATTR Value 1m
SYMATTR Type ind
SYMBOL ind2 1200 0 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L3
SYMATTR Value 1m
SYMATTR Type ind
SYMBOL voltage -704 -160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 15
SYMATTR InstName V4
SYMBOL res -304 1088 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 85 57 VBottom 2
SYMATTR InstName R10
SYMATTR Value 10
SYMBOL res 128 992 R0
SYMATTR InstName R14
SYMATTR Value 3.3k
SYMBOL res 1728 -112 R0
SYMATTR InstName R5
SYMATTR Value 50R
SYMBOL xcomp_x11 48 1024 R0
SYMATTR InstName U5
SYMATTR Value LM311
SYMBOL res 1072 464 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 1k
SYMBOL npn 1520 976 M0
SYMATTR InstName Q2
SYMATTR Value 2N3904
SYMBOL res 1552 1008 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 1k
SYMBOL voltage 32 832 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -271 -43 Left 2
WINDOW 0 -23 -10 Left 2
SYMATTR Value PULSE(0 3.3 0 100n 100n 0.05ms 0.1ms 14)
SYMATTR InstName VIN1
SYMBOL 74hc74 400 736 R0
SYMATTR InstName U1
SYMBOL cap -208 1072 R0
SYMATTR InstName C1
SYMATTR Value 1p
SYMBOL voltage -240 1376 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 0.5
SYMATTR InstName V1
SYMBOL res -96 1248 R0
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL res -96 1328 R0
SYMATTR InstName R15
SYMATTR Value 1k
SYMBOL 74hc74 400 384 R0
SYMATTR InstName U3
SYMBOL 74hc08 800 416 R0
SYMATTR InstName U2
SYMBOL res 1504 464 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1k
SYMBOL npn 1056 976 R0
SYMATTR InstName Q4
SYMATTR Value 2N3904
SYMBOL res 1072 1008 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL 74hc08 800 688 R0
SYMATTR InstName U6
SYMBOL ind2 1200 80 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L4
SYMATTR Value 1m
SYMATTR Type ind
SYMBOL ind2 1488 -112 M90
WINDOW 0 4 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName L5
SYMATTR Value 400µ
SYMATTR Type ind
SYMBOL schottky 1280 -80 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value SS3P5
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL schottky 1296 80 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMATTR Value SS3P5
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL cap 1664 -80 R0
SYMATTR InstName C2
SYMATTR Value 100µ
SYMBOL res 1152 1200 R0
SYMATTR InstName R6
SYMATTR Value 0.2
SYMBOL 74hc04 912 416 R0
SYMATTR InstName U4
SYMBOL pnp 1056 528 M180
SYMATTR InstName Q1
SYMBOL 74hc04 912 688 R0
SYMATTR InstName U7
SYMBOL pnp 1520 528 R180
SYMATTR InstName Q3
TEXT -168 -224 Left 2 !.tran 1.5ms
TEXT -208 -312 Left 2 !.include 74hc.lib
TEXT 1024 -456 Left 2 !K L1 L3 L4  0.99.5
TEXT -184 -368 Left 2 !.include standard.bjt
TEXT -176 -272 Left 2 !.include LM311.301
TEXT 2128 -248 Left 2 ;use mic1557 to generate square wave.\n- use as current-mode  for boost/ flyback/forward. , or push pull as is.\n- for push-pull divide the square wave with another flip flop. to alternate\n- for buck, need over-the-top current sense\n- can also use another clock-divider - to get a 50% max duty. and avoid compensation\n- could also drive AB slew, with op-amp  .\n- current-mode push-pull is nice because doesn't need compensation\n- for running without compensation, use clock divider. and just do an async rst. in second half\n--\ncurrent-mode push-pull is nice, because avoids compensation circuit, is balanced, reduce  flux-walk. dont need sense gain amp.\ncompensation must reduce the set voltage,  rather than add to current-sense. for  continuous conduction\nnote how comparator is inverted, which gives open-drain OR. possibility\n- \nrather than sense gain amp. may be better to use a resistor divider. to divide down the comp adjusted iset.
TEXT 2136 256 Left 2 ;This shows Iramp, and Iset and effect of COMP reducing to force\ncomp range 0-1V.  eg. for Iramp 0-100mV.\ndivider after op-amp gives op-amp  headroom. and allows us to use 1.25V refernce. and avoid Iramp amplifier.\nthere's an issue if  ICTL/SET  goes too high. then comp doesnt turn off before the end of the cycle\nso pulses get stretched.\nit may be ok. the point of comp is to avoid sub-harmonic oscillation. not to turn off before the cycle \nthe fact that it is not on the cycle, if the error amplifier is indicating to high-power may be  ok.\na separate omparator to force off at eg. 200mV regardless of the error amplifier could be good. like lm3481\n--\nadd a second open-drain comparaotr. for 200mV. as current shutoff, to cover err amplifier wrong, or output short-circuit.
TEXT 1256 -512 Left 2 ;Needs a rectifier, and output inductor for ramp
TEXT 1816 784 Left 2 ;OK. lets put the sense resistor. like a buck\non the secondary side.

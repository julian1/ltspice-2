Version 4
SHEET 1 5720 1884
WIRE 400 -208 400 -224
WIRE 768 -208 400 -208
WIRE 768 -192 768 -208
WIRE 400 -160 400 -208
WIRE 1520 -96 1344 -96
WIRE 176 -48 80 -48
WIRE 400 -48 400 -80
WIRE 400 -48 240 -48
WIRE 768 -48 768 -112
WIRE 928 -48 768 -48
WIRE 1088 -48 992 -48
WIRE 400 -16 400 -48
WIRE 768 -16 768 -48
WIRE 1520 -16 1344 -16
WIRE 80 16 80 -48
WIRE 80 16 32 16
WIRE 96 16 80 16
WIRE 1088 16 1088 -48
WIRE 1088 16 1072 16
WIRE 1136 16 1088 16
WIRE 336 32 240 32
WIRE 928 32 832 32
WIRE 1520 32 1520 -16
WIRE 96 48 32 48
WIRE 1136 48 1072 48
WIRE 32 64 32 48
WIRE 1136 64 1136 48
WIRE 400 112 400 80
WIRE 400 112 320 112
WIRE 544 112 400 112
WIRE 768 112 768 80
WIRE 768 112 544 112
WIRE 848 112 768 112
WIRE 528 368 304 368
WIRE 304 464 304 368
WIRE 864 464 496 464
WIRE 1040 480 976 480
WIRE 304 496 224 496
WIRE 528 528 528 368
WIRE 528 528 496 528
WIRE 736 528 528 528
WIRE 544 816 496 816
WIRE 576 816 544 816
WIRE 208 848 32 848
WIRE 224 848 224 496
WIRE 224 848 208 848
WIRE 304 848 224 848
WIRE 736 848 736 528
WIRE 864 848 736 848
WIRE 496 944 496 880
WIRE 544 944 496 944
WIRE 576 944 544 944
WIRE -192 1072 -208 1072
WIRE 16 1072 -192 1072
WIRE 144 1088 80 1088
WIRE 400 1088 400 960
WIRE 400 1088 144 1088
WIRE 16 1104 -32 1104
WIRE -32 1216 -32 1104
WIRE -80 1264 -240 1264
WIRE -240 1328 -240 1264
WIRE -32 1344 -32 1216
WIRE -32 1344 -80 1344
WIRE -240 1392 -240 1328
FLAG -528 -80 0
FLAG -528 -160 VCC
FLAG 400 192 0
FLAG -704 -64 0
FLAG -704 -144 P15V
FLAG 400 -304 P15V
FLAG 544 112 IRAMP
FLAG -288 1072 IRAMP
FLAG 544 816 SW
FLAG 80 1104 0
FLAG 48 1056 VCC
FLAG 144 1008 VCC
FLAG 544 944 CSW
FLAG 1520 32 0
FLAG -48 16 FSW1
FLAG 48 1120 0
FLAG 208 848 QRST
FLAG 32 928 0
FLAG 304 816 VCC
FLAG 400 736 VCC
FLAG -192 1136 0
FLAG -240 1472 0
FLAG -32 1216 ISET
FLAG -80 1424 0
FLAG -240 1328 ICTL
FLAG 400 384 VCC
FLAG 400 608 VCC
FLAG 864 496 SW
FLAG 864 880 SW
FLAG 128 0 VCC
FLAG 128 64 0
FLAG 1152 480 FSW1
FLAG 32 144 0
FLAG 1216 16 FSW2
FLAG 1040 0 VCC
FLAG 1040 64 0
FLAG 1136 144 0
FLAG 1088 864 FSW2
SYMBOL voltage -528 -176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 5
SYMATTR InstName V2
SYMBOL ind2 384 -176 R0
SYMATTR InstName L1
SYMATTR Value 1m
SYMATTR Type ind
SYMBOL npn 336 -16 R0
SYMATTR InstName Q1
SYMATTR Value FJL4315
SYMBOL res 384 96 R0
SYMATTR InstName R1
SYMATTR Value 0.1
SYMBOL ind2 1328 0 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L3
SYMATTR Value 1m
SYMATTR Type ind
SYMBOL voltage -704 -160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 5
SYMATTR InstName V4
SYMBOL res 416 -208 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R7
SYMATTR Value 0.001
SYMBOL res -304 1088 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 85 57 VBottom 2
SYMATTR InstName R10
SYMATTR Value 10
SYMBOL res 128 992 R0
SYMATTR InstName R14
SYMATTR Value 3.3k
SYMBOL res 1504 -112 R0
SYMATTR InstName R5
SYMATTR Value 50R
SYMBOL xcomp_x11 48 1024 R0
SYMATTR InstName U5
SYMATTR Value LM311
SYMBOL voltage 32 832 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -271 -43 Left 2
WINDOW 0 -23 -10 Left 2
SYMATTR Value PULSE(0 3.3 0 100n 100n 0.05ms 0.1ms 14)
SYMATTR InstName VIN1
SYMBOL 74hc74 400 736 R0
SYMATTR InstName U1
SYMBOL cap -208 1072 R0
SYMATTR InstName C1
SYMATTR Value 1p
SYMBOL voltage -240 1376 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 0.35
SYMATTR InstName V1
SYMBOL res -96 1248 R0
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL res -96 1328 R0
SYMATTR InstName R15
SYMATTR Value 1k
SYMBOL 74hc74 400 384 R0
SYMATTR InstName U3
SYMBOL 74hc08 912 416 R0
SYMATTR InstName U2
SYMBOL 74hc04 1088 416 R0
SYMATTR InstName U4
SYMBOL 74hc08 912 800 R0
SYMATTR InstName U6
SYMBOL ind2 752 -96 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L2
SYMATTR Value 1m
SYMATTR Type ind
SYMBOL npn 832 -16 M0
SYMATTR InstName Q6
SYMATTR Value FJL4315
SYMBOL OpAmps\\LT1006 128 -32 R0
WINDOW 3 -35 179 Left 2
SYMATTR InstName U8
SYMBOL res 48 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 1k
SYMBOL cap 240 -64 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 -31 -28 VTop 2
SYMATTR InstName C2
SYMATTR Value 1n
SYMBOL res 256 16 R90
WINDOW 0 65 58 VBottom 2
WINDOW 3 42 6 VTop 2
SYMATTR InstName R12
SYMATTR Value 250R
SYMBOL voltage 32 48 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 2.5
SYMATTR InstName V3
SYMBOL OpAmps\\LT1006 1040 -32 M0
WINDOW 3 -35 179 Left 2
SYMATTR InstName U9
SYMBOL res 1120 0 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 1k
SYMBOL cap 928 -64 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 -31 -28 VTop 2
SYMATTR InstName C3
SYMATTR Value 1n
SYMBOL res 912 16 M90
WINDOW 0 65 58 VBottom 2
WINDOW 3 42 6 VTop 2
SYMATTR InstName R8
SYMATTR Value 250R
SYMBOL voltage 1136 48 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 2.5
SYMATTR InstName V5
SYMBOL 74hc04 1024 800 R0
SYMATTR InstName U10
TEXT -168 -224 Left 2 !.tran 1.5ms
TEXT -208 -312 Left 2 !.include 74hc.lib
TEXT 1024 -456 Left 2 !K L1 L2 L3 0.99.5
TEXT -184 -368 Left 2 !.include standard.bjt
TEXT -176 -272 Left 2 !.include LM311.301
TEXT 864 1152 Left 2 ;should just use a fet driver. mcp\n mcp14a0154
TEXT 1496 -384 Left 2 ;slew seems mosty related to op-amp drive.\nthere's an issue that the op-amp output cannot sourcce enough current.\n-\nactually the op-amp + bjt doesn't have enough control. \nthe virtual-ground is bouncing around all over the place.
TEXT 656 -528 Left 2 ;Needs a rectifier, and output inductor for ramp
